{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  <script>
    (function() {
      try {
        var path = window.location.pathname;
        var repoName = "daria-bond-wiki";
        
        // Check if we are already in the English section
        // We look for '/en/' segment.
        if (path.indexOf("/en/") !== -1) {
          sessionStorage.setItem('lang_redirected', 'true');
          return;
        }
        
        // Prevent redirect loop if already redirected in this session
        if (sessionStorage.getItem('lang_redirected')) {
          return;
        }

        var lang = navigator.language || navigator.userLanguage;
        if (!lang) return;
        lang = lang.toLowerCase();

        // If language is NOT Persian (fa), NOT Arabic (ar), and NOT Dari (prs)
        if (!lang.startsWith('fa') && !lang.startsWith('ar') && !lang.startsWith('prs')) {
          var newPath;
          
          if (path.startsWith("/" + repoName + "/")) {
            // Production: /daria-bond-wiki/... -> /daria-bond-wiki/en/...
            newPath = path.replace("/" + repoName + "/", "/" + repoName + "/en/");
          } else {
            // Local/Root: /... -> /en/...
            newPath = "/en" + (path === "/" ? "/" : path);
          }
          
          sessionStorage.setItem('lang_redirected', 'true');
          window.location.href = newPath;
        }
      } catch (e) {
        console.error("Language redirect error:", e);
      }
    })();
  </script>
{% endblock %}

{% block libs %}
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
  {{ super() }}
{% endblock %}